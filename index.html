<script>
/* ===============================
   DADOS DOS APPS
================================ */
const appsData = {
  'home': { name: 'Início' },
  'ray-links': {
    name: 'Ray Links',
    url: 'https://rayraymaster.github.io/hublink/',
    color: '#FF6B6B'
  },
  'spotify': {
    name: 'Spotify',
    url: 'https://open.spotify.com',
    color: '#1DB954'
  },
  'whatsapp': {
    name: 'WhatsApp',
    url: 'https://web.whatsapp.com',
    color: '#25D366'
  },
  'jw-library': {
    name: 'JW Library',
    url: 'https://www.jw.org/pt/',
    color: '#8A2BE2'
  },
  'jw-org': {
    name: 'JW.org',
    url: 'https://www.jw.org/pt',
    color: '#2196F3'
  },
  'watchtower': {
    name: 'Watchtower Library',
    url: 'https://wol.jw.org',
    color: '#4169E1'
  },
  'vscode': {
    name: 'Visual Studio Code',
    url: 'https://code.visualstudio.com',
    color: '#007ACC'
  },
  'google-photos': {
    name: 'Google Photos',
    url: 'https://photos.google.com',
    color: '#4285F4'
  },
  'riot-client': {
    name: 'Riot Client',
    url: 'https://riotgames.com',
    color: '#FF4654'
  }
};

/* ===============================
   DETECÇÃO DE DISPOSITIVO
================================ */
function isMobileDevice() {
  return /Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
}

/* ===============================
   NAVEGAÇÃO ENTRE PÁGINAS
================================ */
function navigateToPage(pageId) {
  document.querySelectorAll('.nav-icon').forEach(i => i.classList.remove('active'));
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));

  const icon = document.querySelector(`.nav-icon[data-page="${pageId}"]`);
  const page = document.getElementById(`${pageId}-page`);

  if (icon) icon.classList.add('active');
  if (page) page.classList.add('active');
  else {
    document.getElementById('home-page').classList.add('active');
    document.querySelector('.nav-icon[data-page="home"]').classList.add('active');
  }

  window.scrollTo(0, 0);
}

/* ===============================
   EVENTOS DE NAVEGAÇÃO
================================ */
document.querySelectorAll('.nav-icon').forEach(icon => {
  icon.addEventListener('click', () => {
    navigateToPage(icon.dataset.page);
  });
});

document.querySelectorAll('.app-card').forEach(card => {
  card.addEventListener('click', () => {
    navigateToPage(card.dataset.app);
  });
});

document.querySelectorAll('.back-button').forEach(btn => {
  btn.addEventListener('click', () => navigateToPage('home'));
});

/* ===============================
   TERMOS
================================ */
document.querySelector('.terms-icon').addEventListener('click', function () {
  window.open('termos.html', '_blank');
});

/* ===============================
   ABERTURA DE APPS (SEGURA)
================================ */
function openApp(url, button, appId) {
  const original = button.innerHTML;

  button.innerHTML = 'ABRINDO...';
  button.disabled = true;

  /* 
     AÇÃO ÚNICA POR CLIQUE
     SEM FALLBACK AUTOMÁTICO
  */
  window.open(url, '_blank');

  /* Fallback manual (visível) */
  if (!button.nextElementSibling) {
    const fallback = document.createElement('a');
    fallback.href = appsData[appId]?.url || url;
    fallback.target = '_blank';
    fallback.textContent = 'Abrir pelo site';
    fallback.style.display = 'block';
    fallback.style.marginTop = '8px';
    button.parentNode.appendChild(fallback);
  }

  setTimeout(() => {
    button.innerHTML = original;
    button.disabled = false;
  }, 800);
}

/* ===============================
   BOTÕES DE LANÇAR
================================ */
document.querySelectorAll('.launch-button').forEach(button => {
  button.addEventListener('click', () => {
    const url = button.dataset.url;
    const appId = button.closest('.app-page').id.replace('-page', '');
    if (url) openApp(url, button, appId);
  });
});

/* ===============================
   INICIALIZAÇÃO
================================ */
document.addEventListener('DOMContentLoaded', () => {
  navigateToPage('home');
});

/* ===============================
   TECLA ESC
================================ */
document.addEventListener('keydown', e => {
  if (e.key === 'Escape') navigateToPage('home');
});
</script>
